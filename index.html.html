<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashCard App - Modo Teste Corrigido</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #4255ff;
            --secondary-color: #3ccfcf;
            --text-color: #333;
            --light-bg: #f6f7fb;
            --card-bg: #ffffff;
            --success-color: #5cb85c;
            --warning-color: #f0ad4e;
            --danger-color: #ff4757;
            --border-radius: 12px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            padding: 0;
        }
        
        .app-container {
            max-width: 100%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 16px 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .user-actions {
            display: flex;
            gap: 15px;
        }
        
        .user-actions button {
            background: transparent;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .main-content {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .view {
            display: none;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            margin-bottom: 20px;
            flex: 1;
        }
        
        .active-view {
            display: flex;
            flex-direction: column;
        }
        
        .page-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .page-title i {
            font-size: 1.5rem;
        }
        
        h2 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }
        
        .btn:hover {
            background-color: #3141d8;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--secondary-color);
        }
        
        .btn-secondary:hover {
            background-color: #2bb6b6;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
        }
        
        .btn-danger:hover {
            background-color: #ff3742;
        }
        
        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
        }
        
        .btn-outline:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        /* Dashboard Styles */
        .sets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .set-card {
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--box-shadow);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            border-left: 5px solid var(--primary-color);
            position: relative;
        }
        
        .set-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .set-title {
            font-size: 1.2rem;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .set-count {
            color: #777;
            font-size: 0.9rem;
            margin-top: auto;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .set-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
        }
        
        .set-action-btn {
            background: transparent;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .edit-btn {
            color: var(--primary-color);
        }
        
        .edit-btn:hover {
            background-color: rgba(66, 85, 255, 0.1);
        }
        
        .delete-btn {
            color: var(--danger-color);
        }
        
        .delete-btn:hover {
            background-color: rgba(255, 71, 87, 0.1);
        }
        
        /* Create/Edit Set Styles */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        
        .card-item {
            background-color: var(--light-bg);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid var(--secondary-color);
            position: relative;
        }
        
        .card-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .remove-card {
            background-color: var(--danger-color);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Study Modes Styles */
        .study-mode-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .mode-btn {
            flex: 1;
            min-width: 150px;
            text-align: center;
            padding: 15px;
            background-color: var(--card-bg);
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .mode-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-3px);
        }
        
        .mode-btn.active {
            border-color: var(--primary-color);
            background-color: rgba(66, 85, 255, 0.1);
        }
        
        .mode-btn i {
            font-size: 1.5rem;
            color: var(--primary-color);
        }
        
        .flashcard {
            perspective: 1000px;
            width: 100%;
            height: 300px;
            margin: 0 auto;
            cursor: pointer;
        }
        
        .flashcard-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        
        .flashcard.flipped .flashcard-inner {
            transform: rotateY(180deg);
        }
        
        .flashcard-front, .flashcard-back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--box-shadow);
            background-color: white;
        }
        
        .flashcard-back {
            transform: rotateY(180deg);
        }
        
        .card-content {
            font-size: 1.5rem;
            text-align: center;
            font-weight: 500;
        }
        
        .study-controls {
            display: flex;
            justify-content: space-between;
            margin-top: 25px;
            gap: 10px;
        }
        
        .study-controls .btn {
            flex: 1;
        }
        
        .progress-indicator {
            text-align: center;
            margin: 20px 0;
            color: #777;
            font-size: 1.1rem;
        }
        
        /* Test Mode Styles */
        .test-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--box-shadow);
        }
        
        .test-question {
            font-size: 1.3rem;
            margin-bottom: 20px;
            font-weight: 500;
            line-height: 1.4;
        }
        
        .test-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .test-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-option:hover {
            border-color: var(--primary-color);
            background-color: rgba(66, 85, 255, 0.05);
        }
        
        .test-option.selected {
            border-color: var(--primary-color);
            background-color: rgba(66, 85, 255, 0.1);
        }
        
        .test-feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .test-feedback.correct {
            background-color: rgba(92, 184, 92, 0.1);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        
        .test-feedback.incorrect {
            background-color: rgba(240, 173, 78, 0.1);
            border: 1px solid var(--warning-color);
            color: var(--warning-color);
        }
        
        .test-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Match Game Styles */
        .match-game-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .match-item {
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            box-shadow: var(--box-shadow);
            transition: transform 0.2s;
            font-weight: 500;
        }
        
        .match-item:hover {
            transform: translateY(-3px);
        }
        
        .match-item.selected {
            background-color: rgba(66, 85, 255, 0.2);
            border: 2px solid var(--primary-color);
        }
        
        .match-item.matched {
            background-color: var(--success-color);
            color: white;
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: #777;
            font-size: 0.9rem;
            transition: color 0.3s;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 4px;
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--box-shadow);
        }
        
        .modal-title {
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        /* Responsive Styles */
        @media (max-width: 768px) {
            .sets-grid {
                grid-template-columns: 1fr;
            }
            
            .study-mode-selector {
                flex-direction: column;
            }
            
            .match-game-container {
                grid-template-columns: 1fr;
            }
            
            .study-controls {
                flex-direction: column;
            }
            
            .card-content {
                font-size: 1.2rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .view {
            animation: fadeIn 0.3s ease-out;
        }
        
        .set-card {
            animation: fadeIn 0.4s ease-out;
        }
        
        /* Loading indicator */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(66, 85, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>FlashCard App</span>
            </div>
            <div class="user-actions">
                <button><i class="fas fa-search"></i></button>
                <button><i class="fas fa-cog"></i></button>
            </div>
        </header>

        <div class="main-content">
            <!-- Dashboard View -->
            <div id="dashboard" class="view active-view">
                <div class="page-title">
                    <i class="fas fa-home"></i>
                    <h2>Meus Conjuntos</h2>
                </div>
                
                <button class="btn" onclick="showView('create-set')">
                    <i class="fas fa-plus"></i>
                    Criar Novo Conjunto
                </button>
                
                <div class="sets-grid" id="sets-container">
                    <!-- Sets will be dynamically added here -->
                </div>
            </div>

            <!-- Create Set View -->
            <div id="create-set" class="view">
                <div class="page-title">
                    <i class="fas fa-pen"></i>
                    <h2>Criar Novo Conjunto</h2>
                </div>
                
                <div class="form-group">
                    <label for="set-title">Título do Conjunto</label>
                    <input type="text" id="set-title" class="form-control" placeholder="Ex: Vocabulário de Inglês">
                </div>
                
                <div class="form-group">
                    <label for="set-description">Descrição (opcional)</label>
                    <textarea id="set-description" class="form-control" placeholder="Descreva o conteúdo deste conjunto"></textarea>
                </div>
                
                <h3>Cartões</h3>
                <div id="cards-container">
                    <!-- Cards will be dynamically added here -->
                </div>
                
                <button class="btn" onclick="addNewCard()">
                    <i class="fas fa-plus"></i>
                    Adicionar Cartão
                </button>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn" onclick="saveSet()">
                        <i class="fas fa-save"></i>
                        Salvar Conjunto
                    </button>
                    <button class="btn btn-outline" onclick="showView('dashboard')">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                </div>
            </div>

            <!-- Edit Set View -->
            <div id="edit-set" class="view">
                <div class="page-title">
                    <i class="fas fa-edit"></i>
                    <h2>Editar Conjunto</h2>
                </div>
                
                <div class="form-group">
                    <label for="edit-set-title">Título do Conjunto</label>
                    <input type="text" id="edit-set-title" class="form-control" placeholder="Ex: Vocabulário de Inglês">
                </div>
                
                <div class="form-group">
                    <label for="edit-set-description">Descrição (opcional)</label>
                    <textarea id="edit-set-description" class="form-control" placeholder="Descreva o conteúdo deste conjunto"></textarea>
                </div>
                
                <h3>Cartões</h3>
                <div id="edit-cards-container">
                    <!-- Cards will be dynamically added here -->
                </div>
                
                <button class="btn" onclick="addNewEditCard()">
                    <i class="fas fa-plus"></i>
                    Adicionar Cartão
                </button>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn" onclick="updateSet()">
                        <i class="fas fa-save"></i>
                        Atualizar Conjunto
                    </button>
                    <button class="btn btn-outline" onclick="showView('dashboard')">
                        <i class="fas fa-times"></i>
                        Cancelar
                    </button>
                </div>
            </div>

            <!-- Study Modes View -->
            <div id="study-modes" class="view">
                <div class="page-title">
                    <i class="fas fa-book-open"></i>
                    <h2>Modos de Estudo</h2>
                </div>
                
                <div class="sets-grid" id="study-sets-container">
                    <!-- Sets for study will be dynamically added here -->
                </div>
                
                <div id="study-area" style="display: none;">
                    <h2 id="study-set-title"></h2>
                    
                    <div class="study-mode-selector">
                        <div class="mode-btn active" data-mode="flashcards" onclick="selectMode('flashcards')">
                            <i class="fas fa-id-card"></i>
                            <span>Flashcards</span>
                        </div>
                        <div class="mode-btn" data-mode="test" onclick="selectMode('test')">
                            <i class="fas fa-file-alt"></i>
                            <span>Teste</span>
                        </div>
                        <div class="mode-btn" data-mode="write" onclick="selectMode('write')">
                            <i class="fas fa-pencil-alt"></i>
                            <span>Escrever</span>
                        </div>
                        <div class="mode-btn" data-mode="match" onclick="selectMode('match')">
                            <i class="fas fa-puzzle-piece"></i>
                            <span>Combinar</span>
                        </div>
                    </div>
                    
                    <!-- Flashcards Mode -->
                    <div id="flashcards-mode" class="study-mode">
                        <div class="flashcard" onclick="flipCard()">
                            <div class="flashcard-inner">
                                <div class="flashcard-front">
                                    <div class="card-content" id="card-term"></div>
                                </div>
                                <div class="flashcard-back">
                                    <div class="card-content" id="card-definition"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress-indicator">
                            <span id="current-card">1</span> de <span id="total-cards">0</span>
                        </div>
                        
                        <div class="study-controls">
                            <button class="btn" onclick="prevCard()">
                                <i class="fas fa-arrow-left"></i>
                                Anterior
                            </button>
                            <button class="btn btn-secondary" onclick="markCardKnown()">
                                <i class="fas fa-check"></i>
                                Sei
                            </button>
                            <button class="btn btn-outline" onclick="markCardUnknown()">
                                <i class="fas fa-times"></i>
                                Não Sei
                            </button>
                            <button class="btn" onclick="nextCard()">
                                Próximo
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Test Mode -->
                    <div id="test-mode" class="study-mode" style="display: none;">
                        <div class="test-container">
                            <div class="progress-indicator">
                                <span id="test-current">1</span> de <span id="test-total">0</span>
                            </div>
                            <div class="test-question" id="test-question"></div>
                            <div class="test-options" id="test-options">
                                <!-- Options will be dynamically added here -->
                            </div>
                            <div class="test-feedback" id="test-feedback"></div>
                            <div class="test-navigation">
                                <button class="btn btn-outline" onclick="prevTestQuestion()">
                                    <i class="fas fa-arrow-left"></i>
                                    Anterior
                                </button>
                                <button class="btn" onclick="checkTestAnswer()">
                                    Verificar
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn" onclick="nextTestQuestion()">
                                    Próximo
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Write Mode -->
                    <div id="write-mode" class="study-mode" style="display: none;">
                        <div class="test-container">
                            <div class="test-question" id="write-prompt"></div>
                            
                            <div class="form-group">
                                <input type="text" id="write-answer" class="form-control" placeholder="Escreva a definição/resposta">
                            </div>
                            
                            <div class="progress-indicator">
                                <span id="write-current">1</span> de <span id="write-total">0</span>
                            </div>
                            
                            <div class="test-feedback" id="write-feedback"></div>
                            
                            <div class="test-navigation">
                                <button class="btn btn-outline" onclick="prevWriteCard()">
                                    <i class="fas fa-arrow-left"></i>
                                    Anterior
                                </button>
                                <button class="btn" onclick="checkAnswer()">
                                    Verificar
                                    <i class="fas fa-check"></i>
                                </button>
                                <button class="btn" onclick="nextWriteCard()">
                                    Próximo
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Match Mode -->
                    <div id="match-mode" class="study-mode" style="display: none;">
                        <div class="match-game-container" id="match-game">
                            <!-- Match items will be dynamically added here -->
                        </div>
                        
                        <div style="text-align: center; margin-top: 20px;">
                            <p>Tempo: <span id="match-timer">0</span>s</p>
                            <button class="btn" onclick="resetMatchGame()">
                                <i class="fas fa-redo"></i>
                                Reiniciar
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-outline" onclick="exitStudyMode()">
                            <i class="fas fa-arrow-left"></i>
                            Voltar para Conjuntos
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Confirmation Modal -->
        <div id="delete-modal" class="modal">
            <div class="modal-content">
                <h3 class="modal-title">Confirmar Exclusão</h3>
                <p>Tem certeza que deseja excluir este conjunto? Esta ação não pode ser desfeita.</p>
                <div class="modal-actions">
                    <button class="btn btn-outline" onclick="closeModal('delete-modal')">Cancelar</button>
                    <button class="btn btn-danger" onclick="confirmDeleteSet()">Excluir</button>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showView('dashboard')">
                <i class="fas fa-home"></i>
                <span>Início</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('study-modes')">
                <i class="fas fa-book-open"></i>
                <span>Estudar</span>
            </a>
            <a href="#" class="nav-item" onclick="showView('create-set')">
                <i class="fas fa-plus"></i>
                <span>Criar</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-user"></i>
                <span>Perfil</span>
            </a>
        </div>
    </div>

    <script>
        // Data storage
        let sets = JSON.parse(localStorage.getItem('flashcardSets')) || [];
        let currentSetId = null;
        let currentStudySet = null;
        let currentCardIndex = 0;
        let currentMode = 'flashcards';
        let matchGameTimer = null;
        let matchGameTime = 0;
        let selectedMatchItems = [];
        let testOptions = [];
        let setToDelete = null;

        // Initialize the app
        function initApp() {
            renderSets();
            addNewCard(); // Add one initial card to the create form
            
            // Add sample set if no sets exist
            if (sets.length === 0) {
                sets.push({
                    id: 'sample-set',
                    title: 'Foundations of cybersecurity',
                    description: 'Sample set for demonstration',
                    cards: [
                        {
                            term: 'Security frameworks are ___',
                            definition: 'Guidelines used to build plans to help mitigate threats and risks of data and privacy',
                            known: false
                        },
                        {
                            term: 'Encryption',
                            definition: 'The process of converting information or data into a code to prevent unauthorized access',
                            known: false
                        },
                        {
                            term: 'Firewall',
                            definition: 'A network security system that monitors and controls incoming and outgoing network traffic',
                            known: false
                        }
                    ],
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('flashcardSets', JSON.stringify(sets));
            }
        }

        // View navigation
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.remove('active-view');
            });
            document.getElementById(viewId).classList.add('active-view');
            
            // Update bottom nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (viewId === 'dashboard') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
                renderSets();
            } else if (viewId === 'study-modes') {
                document.querySelector('.nav-item:nth-child(2)').classList.add('active');
                renderStudySets();
            } else if (viewId === 'create-set') {
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
            }
        }

        // Render sets for dashboard
        function renderSets() {
            const setsContainer = document.getElementById('sets-container');
            setsContainer.innerHTML = '';
            
            if (sets.length === 0) {
                setsContainer.innerHTML = '<p>Você ainda não criou nenhum conjunto. Clique em "Criar Novo Conjunto" para começar.</p>';
                return;
            }
            
            sets.forEach(set => {
                const setElement = document.createElement('div');
                setElement.className = 'set-card';
                setElement.innerHTML = `
                    <div class="set-actions">
                        <button class="set-action-btn edit-btn" onclick="editSet('${set.id}', event)">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="set-action-btn delete-btn" onclick="deleteSet('${set.id}', event)">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <h3 class="set-title">${set.title}</h3>
                    <p>${set.description || ''}</p>
                    <div class="set-count">
                        <i class="fas fa-sticky-note"></i>
                        ${set.cards.length} cartões
                    </div>
                `;
                setElement.addEventListener('click', () => studySet(set.id));
                setsContainer.appendChild(setElement);
            });
        }

        // Render sets for study selection
        function renderStudySets() {
            const studySetsContainer = document.getElementById('study-sets-container');
            studySetsContainer.innerHTML = '';
            
            if (sets.length === 0) {
                studySetsContainer.innerHTML = '<p>Você ainda não criou nenhum conjunto. Crie um conjunto primeiro para poder estudar.</p>';
                return;
            }
            
            sets.forEach(set => {
                const setElement = document.createElement('div');
                setElement.className = 'set-card';
                setElement.innerHTML = `
                    <h3 class="set-title">${set.title}</h3>
                    <p>${set.description || ''}</p>
                    <div class="set-count">
                        <i class="fas fa-sticky-note"></i>
                        ${set.cards.length} cartões
                    </div>
                `;
                setElement.addEventListener('click', () => startStudying(set.id));
                studySetsContainer.appendChild(setElement);
            });
        }

        // Add new card to the creation form
        function addNewCard() {
            const cardsContainer = document.getElementById('cards-container');
            const cardIndex = cardsContainer.children.length;
            
            const cardElement = document.createElement('div');
            cardElement.className = 'card-item';
            cardElement.innerHTML = `
                <div class="card-item-header">
                    <h4>Cartão ${cardIndex + 1}</h4>
                    <button class="remove-card" onclick="removeCard(this)">×</button>
                </div>
                <div class="form-group">
                    <label>Termo</label>
                    <input type="text" class="form-control card-term" placeholder="Termo ou pergunta">
                </div>
                <div class="form-group">
                    <label>Definição</label>
                    <textarea class="form-control card-definition" placeholder="Definição ou resposta"></textarea>
                </div>
            `;
            
            cardsContainer.appendChild(cardElement);
        }

        // Add new card to the edit form
        function addNewEditCard() {
            const cardsContainer = document.getElementById('edit-cards-container');
            const cardIndex = cardsContainer.children.length;
            
            const cardElement = document.createElement('div');
            cardElement.className = 'card-item';
            cardElement.innerHTML = `
                <div class="card-item-header">
                    <h4>Cartão ${cardIndex + 1}</h4>
                    <button class="remove-card" onclick="removeEditCard(this)">×</button>
                </div>
                <div class="form-group">
                    <label>Termo</label>
                    <input type="text" class="form-control edit-card-term" placeholder="Termo ou pergunta">
                </div>
                <div class="form-group">
                    <label>Definição</label>
                    <textarea class="form-control edit-card-definition" placeholder="Definição ou resposta"></textarea>
                </div>
            `;
            
            cardsContainer.appendChild(cardElement);
        }

        // Remove card from creation form
        function removeCard(button) {
            const cardItem = button.closest('.card-item');
            cardItem.remove();
            
            // Renumber remaining cards
            document.querySelectorAll('.card-item h4').forEach((header, index) => {
                header.textContent = `Cartão ${index + 1}`;
            });
        }

        // Remove card from edit form
        function removeEditCard(button) {
            const cardItem = button.closest('.card-item');
            cardItem.remove();
            
            // Renumber remaining cards
            document.querySelectorAll('#edit-cards-container .card-item h4').forEach((header, index) => {
                header.textContent = `Cartão ${index + 1}`;
            });
        }

        // Save new set
        function saveSet() {
            const title = document.getElementById('set-title').value.trim();
            const description = document.getElementById('set-description').value.trim();
            
            if (!title) {
                alert('Por favor, adicione um título para o conjunto.');
                return;
            }
            
            const cards = [];
            document.querySelectorAll('.card-item').forEach(cardItem => {
                const term = cardItem.querySelector('.card-term').value.trim();
                const definition = cardItem.querySelector('.card-definition').value.trim();
                
                if (term && definition) {
                    cards.push({ term, definition, known: false });
                }
            });
            
            if (cards.length === 0) {
                alert('Por favor, adicione pelo menos um cartão válido.');
                return;
            }
            
            const newSet = {
                id: Date.now().toString(),
                title,
                description,
                cards,
                createdAt: new Date().toISOString()
            };
            
            sets.push(newSet);
            localStorage.setItem('flashcardSets', JSON.stringify(sets));
            
            // Reset form
            document.getElementById('set-title').value = '';
            document.getElementById('set-description').value = '';
            document.getElementById('cards-container').innerHTML = '';
            addNewCard();
            
            alert('Conjunto salvo com sucesso!');
            showView('dashboard');
        }

        // Edit set
        function editSet(setId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            const set = sets.find(s => s.id === setId);
            if (!set) return;
            
            // Populate the edit form
            document.getElementById('edit-set-title').value = set.title;
            document.getElementById('edit-set-description').value = set.description || '';
            
            // Clear existing cards
            document.getElementById('edit-cards-container').innerHTML = '';
            
            // Add cards to the edit form
            set.cards.forEach(card => {
                const cardsContainer = document.getElementById('edit-cards-container');
                const cardIndex = cardsContainer.children.length;
                
                const cardElement = document.createElement('div');
                cardElement.className = 'card-item';
                cardElement.innerHTML = `
                    <div class="card-item-header">
                        <h4>Cartão ${cardIndex + 1}</h4>
                        <button class="remove-card" onclick="removeEditCard(this)">×</button>
                    </div>
                    <div class="form-group">
                        <label>Termo</label>
                        <input type="text" class="form-control edit-card-term" value="${card.term}" placeholder="Termo ou pergunta">
                    </div>
                    <div class="form-group">
                        <label>Definição</label>
                        <textarea class="form-control edit-card-definition" placeholder="Definição ou resposta">${card.definition}</textarea>
                    </div>
                `;
                
                cardsContainer.appendChild(cardElement);
            });
            
            // Store the current set ID for updating
            currentSetId = setId;
            
            // Show the edit view
            showView('edit-set');
        }

        // Update set
        function updateSet() {
            const title = document.getElementById('edit-set-title').value.trim();
            const description = document.getElementById('edit-set-description').value.trim();
            
            if (!title) {
                alert('Por favor, adicione um título para o conjunto.');
                return;
            }
            
            const cards = [];
            document.querySelectorAll('#edit-cards-container .card-item').forEach(cardItem => {
                const term = cardItem.querySelector('.edit-card-term').value.trim();
                const definition = cardItem.querySelector('.edit-card-definition').value.trim();
                
                if (term && definition) {
                    cards.push({ term, definition, known: false });
                }
            });
            
            if (cards.length === 0) {
                alert('Por favor, adicione pelo menos um cartão válido.');
                return;
            }
            
            // Find the set index
            const setIndex = sets.findIndex(s => s.id === currentSetId);
            if (setIndex === -1) return;
            
            // Update the set
            sets[setIndex].title = title;
            sets[setIndex].description = description;
            sets[setIndex].cards = cards;
            
            // Save to localStorage
            localStorage.setItem('flashcardSets', JSON.stringify(sets));
            
            alert('Conjunto atualizado com sucesso!');
            showView('dashboard');
        }

        // Delete set
        function deleteSet(setId, event) {
            if (event) {
                event.stopPropagation();
            }
            
            setToDelete = setId;
            openModal('delete-modal');
        }

        // Confirm set deletion
        function confirmDeleteSet() {
            if (!setToDelete) return;
            
            // Find the set index
            const setIndex = sets.findIndex(s => s.id === setToDelete);
            if (setIndex === -1) return;
            
            // Remove the set
            sets.splice(setIndex, 1);
            
            // Save to localStorage
            localStorage.setItem('flashcardSets', JSON.stringify(sets));
            
            // Close the modal
            closeModal('delete-modal');
            
            // Refresh the sets list
            renderSets();
            
            alert('Conjunto excluído com sucesso!');
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Start studying a set
        function startStudying(setId) {
            currentSetId = setId;
            currentStudySet = sets.find(set => set.id === setId);
            
            if (!currentStudySet) {
                alert('Conjunto não encontrado.');
                return;
            }
            
            document.getElementById('study-set-title').textContent = currentStudySet.title;
            document.getElementById('study-area').style.display = 'block';
            document.getElementById('study-sets-container').style.display = 'none';
            
            // Reset study state
            currentCardIndex = 0;
            currentMode = 'flashcards';
            selectMode('flashcards');
            
            // Update card counts
            document.getElementById('total-cards').textContent = currentStudySet.cards.length;
            document.getElementById('write-total').textContent = currentStudySet.cards.length;
            document.getElementById('test-total').textContent = currentStudySet.cards.length;
            
            // Load first card
            loadCurrentCard();
        }

        // Exit study mode
        function exitStudyMode() {
            document.getElementById('study-area').style.display = 'none';
            document.getElementById('study-sets-container').style.display = 'grid';
            
            if (matchGameTimer) {
                clearInterval(matchGameTimer);
                matchGameTimer = null;
            }
        }

        // Select study mode
        function selectMode(mode) {
            currentMode = mode;
            
            // Update UI
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.mode-btn[data-mode="${mode}"]`).classList.add('active');
            
            // Hide all modes
            document.querySelectorAll('.study-mode').forEach(modeElement => {
                modeElement.style.display = 'none';
            });
            
            // Show selected mode
            document.getElementById(`${mode}-mode`).style.display = 'block';
            
            // Initialize mode if needed
            if (mode === 'match') {
                initMatchGame();
            } else if (mode === 'write') {
                initWriteMode();
            } else if (mode === 'test') {
                initTestMode();
            } else {
                loadCurrentCard();
            }
        }

        // Load current card for flashcard mode
        function loadCurrentCard() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            const card = currentStudySet.cards[currentCardIndex];
            document.getElementById('card-term').textContent = card.term;
            document.getElementById('card-definition').textContent = card.definition;
            document.getElementById('current-card').textContent = currentCardIndex + 1;
            
            // Reset card flip
            document.querySelector('.flashcard').classList.remove('flipped');
        }

        // Flip card in flashcard mode
        function flipCard() {
            document.querySelector('.flashcard').classList.toggle('flipped');
        }

        // Navigate to next card
        function nextCard() {
            if (currentCardIndex < currentStudySet.cards.length - 1) {
                currentCardIndex++;
                loadCurrentCard();
            }
        }

        // Navigate to previous card
        function prevCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                loadCurrentCard();
            }
        }

        // Mark card as known
        function markCardKnown() {
            currentStudySet.cards[currentCardIndex].known = true;
            nextCard();
        }

        // Mark card as unknown
        function markCardUnknown() {
            currentStudySet.cards[currentCardIndex].known = false;
            nextCard();
        }

        // Initialize write mode
        function initWriteMode() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            currentCardIndex = 0;
            loadWriteCard();
        }

        // Load card for write mode - MODIFICADO
        function loadWriteCard() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            const card = currentStudySet.cards[currentCardIndex];
            // MOSTRAR O TERMO (pergunta) em vez da definição
            document.getElementById('write-prompt').textContent = card.term;
            document.getElementById('write-answer').value = '';
            document.getElementById('write-current').textContent = currentCardIndex + 1;
            document.getElementById('write-feedback').style.display = 'none';
        }

        // Check answer in write mode - MODIFICADO
        function checkAnswer() {
            const answer = document.getElementById('write-answer').value.trim();
            // COMPARAR COM A DEFINIÇÃO (resposta) em vez do termo
            const correctAnswer = currentStudySet.cards[currentCardIndex].definition;
            const feedbackElement = document.getElementById('write-feedback');
            
            if (answer.toLowerCase() === correctAnswer.toLowerCase()) {
                feedbackElement.innerHTML = 'Correto! ✓';
                feedbackElement.className = 'test-feedback correct';
                feedbackElement.style.display = 'block';
                currentStudySet.cards[currentCardIndex].known = true;
            } else {
                feedbackElement.innerHTML = `Incorreto. A resposta correta é: ${correctAnswer}`;
                feedbackElement.className = 'test-feedback incorrect';
                feedbackElement.style.display = 'block';
                currentStudySet.cards[currentCardIndex].known = false;
            }
        }

        // Next card in write mode
        function nextWriteCard() {
            if (currentCardIndex < currentStudySet.cards.length - 1) {
                currentCardIndex++;
                loadWriteCard();
            }
        }

        // Previous card in write mode
        function prevWriteCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                loadWriteCard();
            }
        }

        // Initialize test mode
        function initTestMode() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            currentCardIndex = 0;
            loadTestQuestion();
        }

        // Load test question
        function loadTestQuestion() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            const card = currentStudySet.cards[currentCardIndex];
            document.getElementById('test-question').textContent = card.term;
            document.getElementById('test-current').textContent = currentCardIndex + 1;
            
            // Generate options (1 correct + 3 random)
            testOptions = [card.definition];
            
            // Add random definitions from other cards
            let attempts = 0;
            while (testOptions.length < 4 && attempts < 20) {
                attempts++;
                const randomIndex = Math.floor(Math.random() * currentStudySet.cards.length);
                const randomDefinition = currentStudySet.cards[randomIndex].definition;
                
                if (!testOptions.includes(randomDefinition)) {
                    testOptions.push(randomDefinition);
                }
            }
            
            // If we couldn't find enough unique options, fill with placeholders
            while (testOptions.length < 4) {
                testOptions.push(`Opção ${testOptions.length + 1}`);
            }
            
            // Shuffle options
            testOptions = shuffleArray(testOptions);
            
            // Render options
            const optionsContainer = document.getElementById('test-options');
            optionsContainer.innerHTML = '';
            
            testOptions.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = 'test-option';
                optionElement.textContent = option;
                optionElement.addEventListener('click', () => {
                    document.querySelectorAll('.test-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    optionElement.classList.add('selected');
                });
                optionsContainer.appendChild(optionElement);
            });
            
            // Hide feedback
            document.getElementById('test-feedback').style.display = 'none';
        }

        // Check test answer
        function checkTestAnswer() {
            const selectedOption = document.querySelector('.test-option.selected');
            const feedbackElement = document.getElementById('test-feedback');
            
            if (!selectedOption) {
                feedbackElement.innerHTML = 'Por favor, selecione uma opção.';
                feedbackElement.className = 'test-feedback incorrect';
                feedbackElement.style.display = 'block';
                return;
            }
            
            const correctAnswer = currentStudySet.cards[currentCardIndex].definition;
            
            if (selectedOption.textContent === correctAnswer) {
                feedbackElement.innerHTML = 'Correto! ✓';
                feedbackElement.className = 'test-feedback correct';
                feedbackElement.style.display = 'block';
                currentStudySet.cards[currentCardIndex].known = true;
            } else {
                feedbackElement.innerHTML = `Incorreto. A resposta correta é: ${correctAnswer}`;
                feedbackElement.className = 'test-feedback incorrect';
                feedbackElement.style.display = 'block';
                currentStudySet.cards[currentCardIndex].known = false;
            }
        }

        // Next test question
        function nextTestQuestion() {
            if (currentCardIndex < currentStudySet.cards.length - 1) {
                currentCardIndex++;
                loadTestQuestion();
            }
        }

        // Previous test question
        function prevTestQuestion() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                loadTestQuestion();
            }
        }

        // Initialize match game
        function initMatchGame() {
            if (!currentStudySet || currentStudySet.cards.length === 0) return;
            
            const matchGame = document.getElementById('match-game');
            matchGame.innerHTML = '';
            selectedMatchItems = [];
            
            // Create a combined array of terms and definitions
            let items = [];
            currentStudySet.cards.forEach(card => {
                items.push({ type: 'term', content: card.term, id: card.term });
                items.push({ type: 'definition', content: card.definition, id: card.term });
            });
            
            // Shuffle the items
            items = shuffleArray(items);
            
            // Create match items
            items.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'match-item';
                itemElement.textContent = item.content;
                itemElement.dataset.id = item.id;
                itemElement.dataset.type = item.type;
                itemElement.addEventListener('click', () => selectMatchItem(itemElement));
                matchGame.appendChild(itemElement);
            });
            
            // Start timer
            matchGameTime = 0;
            document.getElementById('match-timer').textContent = '0';
            
            if (matchGameTimer) {
                clearInterval(matchGameTimer);
            }
            
            matchGameTimer = setInterval(() => {
                matchGameTime++;
                document.getElementById('match-timer').textContent = matchGameTime;
            }, 1000);
        }

        // Select item in match game
        function selectMatchItem(itemElement) {
            if (itemElement.classList.contains('matched')) return;
            
            itemElement.classList.add('selected');
            selectedMatchItems.push(itemElement);
            
            if (selectedMatchItems.length === 2) {
                const [first, second] = selectedMatchItems;
                
                if (first.dataset.id === second.dataset.id && first.dataset.type !== second.dataset.type) {
                    // Match found
                    first.classList.remove('selected');
                    second.classList.remove('selected');
                    first.classList.add('matched');
                    second.classList.add('matched');
                    
                    // Check if all matches are found
                    checkGameCompletion();
                } else {
                    // No match
                    setTimeout(() => {
                        first.classList.remove('selected');
                        second.classList.remove('selected');
                    }, 1000);
                }
                
                selectedMatchItems = [];
            }
        }

        // Check if match game is completed
        function checkGameCompletion() {
            const allItems = document.querySelectorAll('.match-item');
            const matchedItems = document.querySelectorAll('.match-item.matched');
            
            if (allItems.length === matchedItems.length) {
                clearInterval(matchGameTimer);
                setTimeout(() => {
                    alert(`Parabéns! Você completou o jogo em ${matchGameTime} segundos.`);
                }, 500);
            }
        }

        // Reset match game
        function resetMatchGame() {
            initMatchGame();
        }

        // Utility function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Initialize the app when the page loads
        window.onload = initApp;
    </script>
</body>
</html>